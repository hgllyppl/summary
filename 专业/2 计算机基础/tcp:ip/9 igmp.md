# 本篇说明
本系列为《tcp/ip 详解-卷1》浓缩，本篇为IGMP浓缩。<br>
<span style="color:red">红字</span>为重要说明，<span style="color:orange">橙字</span>为不确定说明，<span style="color:green">绿字</span>待定。

# IGMP
当多播需要跨越多个局域网时，复杂性就增加了，这需要有一个协议让多播路由器了解确定网络中属于确定多播组的任何一个主机以便进行数据转发，这个协议就是Internet组管理协议（IGMP）。

## IGMP报文
正如ICMP一样，IGMP也被当作IP层的一部分，IGMP报文通过IP数据报进行传输，下图显示了IGMP的报文格式：

![](./igmp/IGMP报文.png)

版本：固定为1

类型：1 多播路由器发出的查询报文 2 主机发出的报告报文

校验和：覆盖整个IGMP报文

组地址：为D类IP地址，当类型为查询报文时，此字段为0；当类型为报告报文时，此字段为要参加的组地址

## IGMP协议
### 加入多播组
应用程序使用socket api加入多播组。例：multicastSocket.joinGroup(InetAddress.getByName("224.0.0.1"));

### IGMP报告和查询
多播路由器使用IGMP报文来记录与该路由器相连的网络中组成员的变化情况，使用规则如下：

- 当第一个进程加入一个组时，主机就发送一个IGMP报告。如果一个主机的多个进程加入同一组，只发送一个IGMP报告，这个报告被发送到进程加入组所在的同一接口上。
- 当进程离开一个组时，主机不发送IGMP报告，即便是组中的最后一个进程离开。主机知道在确定的组中已不再有组成员后，在随后收到的IGMP查询中就不再发送报告报文。
- 多播路由器定时发送IGMP查询报文来了解是否还有任何主机的进程加入了多播组。多播路由器必须向每个接口发送一个IGMP查询，因为路由器希望主机对它加入的每个多播组均发回一个报告。
- 主机通过发送IGMP报告来响应一个IGMP查询，对每个至少还有一个进程的多播组均要发回IGMP报告。

使用这些查询和报告报文，多播路由器对每个接口保持一个表，表中记录接口上至少还有一个主机的多播组。当路由器收到要转发的多播数据报时，它只将该数据报转发到相应的多播组所包含的主机接口上。

## 例子
参考《tcp/ip详解-卷1》13.4一节

## 注
虽然IGMP解决了跨越多个局域网的多播，但是并没有解决广域网的多播。

# 参考引用
0. [tcp/ip详解-卷1](https://book.douban.com/subject/1088054/)
